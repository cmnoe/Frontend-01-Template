# 每周总结可以写在这里

## 解析HTML

### 一、拆分文件

1. 为了方便文件管理，把parser单独拆到文件中

2. parser接受HTML文本作为参数，返回一颗DOM树

### 二、创建状态机

1. 使用FSM（有限状态机）来实现HTML的分析

2. 在HTML标准中找出需要的状态和相应的变化关系

### 三、解析标签

1. 将标签分为开始标签、结束标签和自封闭标签

2. 以"<"进入开启标签状态，">"进入结束标签状态，中间用tagName状态记录标签名

### 四、创建元素

1. 在状态机中加入业务逻辑

2. 在标签结束状态提交创建的标签（token）

### 五、处理属性

1. 根据属性名"="后面的字符将单引号、双引号和无引号这三种属性值交由不同的状态处理

2. 属性结束时把属性添加到标签token上

### 六、构建DOM树

1. 使用栈将标签列表构建成DOM树

2. 遇到开始标签时创建元素并入栈，遇到结束标签时出栈

3. 自封闭节点可视为入栈后立刻出栈

4. 任何元素的父元素是它入栈前的栈顶元素

### 七、文本结点

1. 文本节点与自封闭标签处理类似

2. 如果有多个文本节点需要合并为一个

## CSS Computeing

### 一、收集CSS规则

1. 遇到style标签时把CSS规则保存起来

2. 引入CSS Parser包来分析CSS规则

3. 研究清楚分析后的CSS规则的格式

### 二、添加调用

1. 创建一个元素后立即计算CSS

2. 当我们分析一个元素时， 理论上所有CSS规则已经收集完毕

### 三、获取父元素序列

1. 在computeCSS函数中拿到元素的所有父元素用来判断该元素是否与规则匹配

2. 将获取的规则从内向外逐级匹配元素的父元素和祖先元素

### 四、拆分选择器

1. 选择器也要从当前元素向外排列

2. 复杂选择器拆成针对单个元素的选择器，用循环匹配父元素队列

### 五、计算选择器与元素匹配

1. 根据选择器的类型和元素属性，计算是否与当前元素匹配

### 六、生成computed属性

1. 一旦选择匹配，就应用选择器到元素上，形成computedStyle

### 七、确定规则覆盖关系

1. 根据specificity和后来优先规则确定优先级

2. specificity是个四元组，越左边权重越高

3. 一个CSS规则的specificity根据包含的简单选择器相加而成


